<div dir="rtl">

# ุจุฎุด ตุ ุฏุฑุณ ฒ: Query Builder ู Raw Expressions

ุณุณุชู Eloquent ุจุฑุง ุนููุงุช ุฑูุฒูุฑู CRUD ู ฺฉุงุฑ ุจุง ูุฏูโูุง ูููโุงูุนุงุฏู ุงุณุช. ุงูุง ุฒูุงูโูุง ูุฌูุฏ ุฏุงุฑุฏ ฺฉู ุดูุง ุจู ฺฉูุชุฑู ุณุทุญ ูพุงูโุชุฑ ุง ุนููฺฉุฑุฏ ุจุงูุงุชุฑ ูุงุฒ ุฏุงุฑุฏ. ุงูุฌุงุณุช ฺฉู Query Builder ู Raw Expressions ูุงุฑุฏ ูุฏุงู ูโุดููุฏ.

---

### ## ุฑุงุจุท Query Builder: ูุฏุฑุช SQL ุจุง ุฑุงุญุช ูุงุฑุงูู

**ุฑุงุจุท Query Builder** ฺฉ ุฑุงุจุท ุฑูุงู (fluent) ุจุฑุง ุณุงุฎุช ู ุงุฌุฑุง ฺฉูุฆุฑโูุง ุฏุชุงุจุณ ุงุณุช. ุจุฑุฎูุงู Eloquentุ ฺฉูุฆุฑ ุจูุฏุฑ ุจุง ูุฏูโูุง ฺฉุงุฑ ูุฏุงุฑุฏ ู ูุชุงุฌ ุฑุง ุจู ุตูุฑุช ุขุฑุงูโุง ุงุฒ ุขุจุฌฺฉุชโูุง ุงุณุชุงูุฏุงุฑุฏ PHP ุจุฑูโฺฏุฑุฏุงูุฏ.

#### ฺฉ ุงุฒ Query Builder ุจู ุฌุง Eloquent ุงุณุชูุงุฏู ฺฉููุ

**ุจุฑุง ฺฏุฒุงุฑุดโฺฏุฑโูุง ูพฺุฏู:** ููุช ูุงุฒ ุจู ฺฉูุฆุฑโูุง ุณูฺฏู ุจุง ฺูุฏู `JOIN`ุ `GROUP BY`ุ ู ุชูุงุจุน ุชุฌูุน (`SUM`, `AVG`, `COUNT`) ุฏุงุฑุฏุ Query Builder ูุนูููุงู ุณุฑุนโุชุฑ ุงุณุช. ฺูู ุณุฑุจุงุฑ ุชุจุฏู ูุชุงุฌ ุจู ุขุจุฌฺฉุชโูุง Eloquent (Hydration) ุฑุง ูุฏุงุฑุฏ.

**ุจุฑุง ุนููุงุช ุฏุณุชูโุง (Batch Operations):** ุจุฑุง `UPDATE` ุง `DELETE` ฺฉุฑุฏู ูุฒุงุฑุงู ุฑุฏู ุจุฑ ุงุณุงุณ ฺฉ ุดุฑุทุ Query Builder ุจุณุงุฑ ฺฉุงุฑุขูุฏุชุฑ ุงุณุชุ ุฒุฑุง ูุงุฒ ุจู ูุงฺฉุด ูุฏูโูุง ุงุฒ ุฏุชุงุจุณ ูุฏุงุฑุฏ.

**ููุช ุจู ูฺฺฏโูุง ูุฏู ูุงุฒ ูุฏุงุฑุฏ:** ุงฺฏุฑ ููุท ุจู ฺูุฏ ุณุชูู ุณุงุฏู ุงุฒ ฺฉ ุฌุฏูู ุจุฑุง ููุงุด ุฏุฑ ฺฉ ูุณุช ูุงุฒ ุฏุงุฑุฏ ู ุจู ุฑูุงุจุทุ accessors ุง mutator ูุง ูุฏู ุงุญุชุงุฌ ูุฏุงุฑุฏุ Query Builder ุงูุชุฎุงุจ ุณุจฺฉโุชุฑ ุงุณุช.

#### ููุงุณู ุณูุชฺฉุณ

ุณูุชฺฉุณ Query Builder ุจุณุงุฑ ุดุจู ุจู Eloquent ุงุณุช ฺฉู ุงุฏฺฏุฑ ุขู ุฑุง ุขุณุงู ูโฺฉูุฏ.

**Eloquent:**
<div dir="ltr">

```php
use App\Models\User;
$users = User::where('status', 'active')->orderBy('created_at')->get();
```
</div>

**Query Builder:**
<div dir="ltr">

```php
use Illuminate\Support\Facades\DB;
$users = DB::table('users')->where('status', 'active')->orderBy('created_at')->get();
```
</div>

---

### ## ุงุจุฒุงุฑ Raw Expressions (`DB::raw()`): ูุฏุฑุช ุฎุงูุ ูุณุฆููุช ุจุงูุง

**ุงุจุฒุงุฑ Raw Expressions** ุฑุงู ูุฑุงุฑ ุดูุง ุจุฑุง ุฒูุงู ุงุณุช ฺฉู ูฺโฺฉุฏุงู ุงุฒ ุงุจุฒุงุฑูุง Eloquent ุง Query Builder ููโุชูุงููุฏ ฺฉูุฆุฑ ููุฑุฏ ูุธุฑ ุดูุง ุฑุง ุจุณุงุฒูุฏ. ุงู ุงุจุฒุงุฑ ุจู ุดูุง ุงุฌุงุฒู ูโุฏูุฏ ฺฉ ุฑุดุชู SQL ุฎุงู ุฑุง ูุณุชููุงู ุฏุฑ ฺฉูุฆุฑ ุฎูุฏ ุชุฒุฑู ฺฉูุฏ.

#### ฺู ุฒูุงู ุงุฒ `()DB::raw` ุงุณุชูุงุฏู ฺฉููุ

* ุจุฑุง ูุฑุงุฎูุงู ุชูุงุจุน ุฎุงุต ุฏุชุงุจุณ ฺฉู ุฏุฑ ูุงุฑุงูู ูุนุงุฏู ูุฏุงุฑูุฏ (ูุซูุงู ุชูุงุจุน ุฌุบุฑุงูุง ูุงููุฏ `ST_Distance_Sphere`).
* ุจุฑุง ูุญุงุณุจุงุช ูพฺุฏู ุฏุฑ `SELECT` ุง `ORDER BY`.
<div dir="ltr">

```php
$users = DB::table('users')
    ->select(
        'status',
        DB::raw('COUNT(*) as user_count') // COUNT ุงุณุชูุงุฏู ุงุฒ ุชุงุจุน 
    )
    ->groupBy('status')
    ->get();
```
</div>

### โ๏ธ ุฎุทุฑ ุจุฒุฑฺฏ: SQL Injection

ูููโุชุฑู ูฺฉุชูโุง ฺฉู ุจุงุฏ ุจุฏุงูุฏ ุงู ุงุณุช: `()DB::raw` ุชูุงู ูุญุงูุธุชโูุง ุฎูุฏฺฉุงุฑ ูุงุฑุงูู ุฏุฑ ุจุฑุงุจุฑ SQL Injection ุฑุง **ุฏูุฑ ูโุฒูุฏ**. ูุฑ ูุฑูุฏ ฺฉุงุฑุจุฑ ฺฉู ูุณุชููุงู ุฏุฑ ฺฉ ุฑุดุชู `()DB::raw` ูุฑุงุฑ ุฏุงุฏู ุดูุฏุ ุงูพูฺฉุดู ุดูุง ุฑุง ุขุณุจโูพุฐุฑ ูโฺฉูุฏ.

**โ ุฑูุด ูุงุฌุนูโุจุงุฑ (ุขุณุจโูพุฐุฑ):**
<div dir="ltr">

```php
$status = $_GET['status']; // 'active' OR 1=1 ูุซูุง ูุฑูุฏ ุจุฑุงุจุฑ ุงุณุช ุจุง: 
$users = DB::select(DB::raw("SELECT * FROM users WHERE status = '$status'"));
// ุงูพูฺฉุดู ุดูุง ูฺฉ ุดุฏ!
```
</div>

**โ ุฑูุด ุงูู (ุงุณุชูุงุฏู ุงุฒ Bindings):**
ููุดู ูุฑูุฏโูุง ฺฉุงุฑุจุฑ ุฑุง ุจู ุนููุงู ูพุงุฑุงูุชุฑูุง ุฌุฏุงฺฏุงูู (bindings) ุจู ฺฉูุฆุฑ ูพุงุณ ุฏูุฏ. ุฏุฑ ุงู ุญุงูุชุ ูุงุฑุงูู ููุงุฏุฑ ุฑุง "escape" ฺฉุฑุฏู ู ุงุฒ ุชูุณุฑ ุขูโูุง ุจู ุนููุงู ฺฉุฏ SQL ุฌููฺฏุฑ ูโฺฉูุฏ.
<div dir="ltr">

```php
$status = $_GET['status'];
$users = DB::select('SELECT * FROM users WHERE status = ?', [$status]);
```
</div>

ููุช ุงุฒ ูุชุฏูุง ุงุณุชุงูุฏุงุฑุฏ Query Builder ูุงููุฏ `()where` ุงุณุชูุงุฏู ูโฺฉูุฏุ ูุงุฑุงูู ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุงุฒ binding ูุง ุงุณุชูุงุฏู ูโฺฉูุฏ ู ฺฉุฏ ุดูุง ุงูู ุงุณุช. ุฎุทุฑ ููุท ุฒูุงู ุงุณุช ฺฉู ูุฑูุฏ ฺฉุงุฑุจุฑ ุฑุง ูุณุชููุงู ุฏุฑ `()DB::raw` ุงูุญุงู (concatenate) ฺฉูุฏ.

---

### \#\# ุงุณุชูุงุฏู ุงุฒ View ูุง: ุจูุชุฑู ุชุฑฺฉุจ ูุฏุฑุช ู ุณุงุฏฺฏ

ุฏุฑ ุจุฎุด ุฏูู ุงุฏ ฺฏุฑูุชู ฺฉู View ูุง ฺฺฏููู ฺฉูุฆุฑโูุง ูพฺุฏู ุฑุง ุฏุฑ ุฏุชุงุจุณ ฺฉูพุณููู ูโฺฉููุฏ. ุฏุฑ ูุงุฑุงููุ ุดูุง ูโุชูุงูุฏ ุจู ุณุงุฏฺฏ ุงุฒ ุงู View ูุง ุงุณุชูุงุฏู ฺฉูุฏ ู ุขูโูุง ุฑุง ุจู ุจุฎุด ุงุฒ Eloquent ุชุจุฏู ฺฉูุฏ.

ุงู ฺฉุงุฑ ุจู ุดูุง ุงุฌุงุฒู ูโุฏูุฏ ฺฉู ุชูุงู ููุทู ูพฺุฏู `JOIN` ู `GROUP BY` ุฑุง ุฏุฑ ุฏุชุงุจุณ ูฺฏู ุฏุงุฑุฏ (ูุฏุฑุช SQL)ุ ุงูุง ุฏุฑ ฺฉุฏ PHP ุฎูุฏ ุจุง ฺฉ ูุฏู ุชูุฒ Eloquent ุจุง ุขู ฺฉุงุฑ ฺฉูุฏ (ุณุงุฏฺฏ ูุงุฑุงูู).

**ฑ. ุณุงุฎุช View ุฏุฑ Migration:**
ุดูุง ูโุชูุงูุฏ View ุฎูุฏ ุฑุง ุจุง ุงุณุชูุงุฏู ุงุฒ `DB::statement` ุฏุฑ ฺฉ ูุงู Migration ุจุณุงุฒุฏ (ุงู ูุจุญุซ ุฏุฑ ุฏุฑุณ ุจุนุฏ ุจู ุชูุตู ุจุฑุฑุณ ุฎูุงูุฏ ุดุฏุ ุงูุง ุงูุฌุง ุจู ุขู ุงุดุงุฑู ูโฺฉูู):

<div dir="ltr">

```php
// in database/migrations/xxxx_create_sales_report_view.php
public function up()
{
    DB::statement("
        CREATE VIEW product_sales_report AS
        SELECT product_id, SUM(amount) as total_sales
        FROM orders
        GROUP BY product_id
    ");
}
```
</div>

**ฒ. ุณุงุฎุช ูุฏู Eloquent ุจุฑุง View:**
ุญุงูุงุ ฺฉ ูุฏู Eloquent ุจุณุงุฒุฏ ฺฉู ุงูฺฏุงุฑ `product_sales_report` ฺฉ ุฌุฏูู ูุนููู ุงุณุช:

<div dir="ltr">

```php
// in app/Models/ProductSalesReport.php
namespace App\Models;
use Illuminate\Database\Eloquent\Model;

class ProductSalesReport extends Model
{
    // ฑ. ูุงู ูู ุฑุง ุจู ุนููุงู ุฌุฏูู ูุฏู ูุนุฑู ฺฉูุฏ
    protected $table = 'product_sales_report';

    // ฒ.ฺูู ูููุง ูุง  created_at/updated_at ูุฏุงุฑูุฏุ ุขูโูุง ุฑุง ุบุฑูุนุงู ฺฉูุฏ
    public $timestamps = false;
}
```
</div>

**ณ. ุงุณุชูุงุฏู ุงุฒ ูุฏู:**
ุงฺฉููู ูโุชูุงูุฏ ุฏุฑ ฺฉูุชุฑูุฑ ุฎูุฏ ุงุฒ ุงู View ุฏุฑุณุช ูุงููุฏ ฺฉ ูุฏู Eloquent ูุนููู ุงุณุชูุงุฏู ฺฉูุฏ:

<div dir="ltr">

```php
$reports = ProductSalesReport::where('total_sales', '>', 1000)
                              ->orderBy('total_sales', 'desc')
                              ->get();
```
</div>
ุงู ุฑูุดุ ุชูุงู ูุฒุงุง View (ฺฉู ุฏุฑ ุจุฎุด ฒ ฺฏูุชู) ุฑุง ุจุง ุชูุงู ุณุงุฏฺฏ ู ูุฏุฑุช Eloquent ุชุฑฺฉุจ ูโฺฉูุฏ.

---

### ## ุฎูุงุตู: ฺฉุฏุงู ุฑุง ฺฉ ุงุณุชูุงุฏู ฺฉููุ

* ุข) **Eloquent (นฐูช ููุงูุน):** ุจุฑุง ุชูุงู ฺฉุงุฑูุง ุงุณุชุงูุฏุงุฑุฏ CRUDุ ฺฉุงุฑ ุจุง ุฑูุงุจุท ู ูุฏูโูุง.
* ุจ) **Query Builder:** ุจุฑุง ฺฏุฒุงุฑุดโูุง ูพฺุฏูุ ุนููุงุช ุฏุณุชูโุง ู ฺฉูุฆุฑโูุง ุณุงุฏูโุง ฺฉู ูุงุฒ ุจู ูุฏู ูุฏุงุฑูุฏ.
* ูพ) **View (ุจุง ูุฏู Eloquent):** ุจุฑุง ฺฉูพุณููู ฺฉุฑุฏู ฺฉูุฆุฑโูุง ุจุณุงุฑ ูพฺุฏู (JOIN/GROUP BY) ุฏุฑ ุฏุชุงุจุณุ ู ฺฉุงุฑ ุจุง ุขูโูุง ุจู ุณุงุฏฺฏ ฺฉ ูุฏู Eloquent ุฏุฑ ฺฉุฏ.
* ุช) **Raw Expressions:** ุจู ุนููุงู ุขุฎุฑู ุฑุงูโุญู ุจุฑุง ฺฉูุฆุฑโูุง ุจุณุงุฑ ุฎุงุต ู ูพฺุฏูุ ู **ููุดู ุจุง ุงุณุชูุงุฏู ุงุฒ binding** ุจุฑุง ูุฑูุฏโูุง ฺฉุงุฑุจุฑ.

---
[โฉ ุฏุฑุณ ูุจู: ุจูููโุณุงุฒ Eloquent](../01-Eloquent-N-Plus-1/README.md) | [๐ผ ุจุงุฒฺฏุดุช ุจู ููุฑุณุช ูุตู](../README.md) | [๐ ูุซุงู Query Builder](examples/QueryBuilderExample.php) / [๐ ูุซุงู Raw Expression](examples/RawExpressionExample.php) | [ุฏุฑุณ ุจุนุฏ: ุงูุฏฺฉุณโูุง ู Migration ูุง โช](../03-Migrations-And-Indexes/README.md)

</div>
