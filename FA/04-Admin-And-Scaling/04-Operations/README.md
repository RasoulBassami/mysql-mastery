<div dir="rtl">

# ุจุฎุด ดุ ุฏุฑุณ ด: ุนููุงุช ู ูฺฏูุฏุงุฑ (Operations)

ฺฉ ุฏุชุงุจุณ ุณุณุชู ุฒูุฏู ู ูพูุงุณุช. ุนูุงูู ุจุฑ ุทุฑุงุญ ู ุจูููโุณุงุฒ ุงูููุ ุดูุง ุจุงุฏ ุจุฑุง ุนููุงุชโูุง ูพฺุฏู ู ฺุงูุดโูุง ุฑูุฒูุฑูโุง ฺฉู ุฏุฑ ฺฉ ุณุณุชู ุจุฒุฑฺฏ ูพุด ูโุขุฏ ูุฒ ุขูุงุฏู ุจุงุดุฏ.

---

### ## ฑ. ุงูุชูุงู ู ุชุจุฏู ุฏุงุฏู ุฏุฑ ููุงุณ ุจุฒุฑฺฏ

#### ูุงุฑุฏ ฺฉุฑุฏู ุณุฑุน ุญุฌู ุฒุงุฏ ุฏุงุฏู
ูุฑุถ ฺฉูุฏ ูุงุฒ ุฏุงุฑุฏ ฺฉ ูุงู CSV ุจุง ฑฐ ูููู ุฑุฏู ุฏุงุฏู ุฑุง ุจู ฺฉ ุงุฒ ุฌุฏุงูู ุฎูุฏ ูุงุฑุฏ ฺฉูุฏ. ููุดุชู ฺฉ ุงุณฺฉุฑูพุช ฺฉู ุฑุฏูโูุง ุฑุง ฺฉโฺฉ ุจุง ุฏุณุชูุฑ `INSERT` ูุงุฑุฏ ฺฉูุฏุ ุณุงุนุชโูุง (ุง ุญุช ุฑูุฒูุง) ุทูู ุฎูุงูุฏ ฺฉุดุฏ ู ุจู ุฏุชุงุจุณ ูุดุงุฑ ุฒุงุฏ ูุงุฑุฏ ูโฺฉูุฏ.

**ุฑุงูโุญู: `LOAD DATA INFILE`**
ุงู ุฏุณุชูุฑุ ุงุจุฒุงุฑ ุฏุงุฎู ู ูููโุงูุนุงุฏู ุณุฑุน MySQL ุจุฑุง ูุงุฑุฏ ฺฉุฑุฏู ุฏุงุฏู ุจู ุตูุฑุช ุฏุณุชูโุง (Bulk Import) ุงุณุช. `LOAD DATA` ูุงู ุฑุง ูุณุชููุงู ูโุฎูุงูุฏ ู ุฏุงุฏูโูุง ุฑุง ุฏุฑ ฺฉ ุชุฑุงฺฉูุด ุจููู ูุงุฑุฏ ูโฺฉูุฏ ฺฉู ุจุณุงุฑ ุณุฑุนโุชุฑ ุงุฒ ููููโูุง `INSERT` ุฌุฏุงฺฏุงูู ุงุณุช.

<div dir="ltr">

```sql
LOAD DATA INFILE '/var/lib/mysql-files/products.csv' -- ูุณุฑ ูุงู ุจุงุฏ ุจุฑุง ุณุฑูุฑ ูุงุจู ุฏุณุชุฑุณ ุจุงุดุฏ  
INTO TABLE products
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
IGNORE 1 ROWS; -- CSV ุจุฑุง ูุงุฏุฏู ฺฏุฑูุชู ุฑุฏู ูุฏุฑ ูุงู 
```
</div>


> **๐ก ูฺฉุชู ูุนูุงุฑ (ุชูุงูุช ุจุง `mysqldump`):**
> ุฏุฑ ุฑูุด `LOAD DATA`ุ ฺฉู ุนููุงุช ุจู ุนููุงู **ฺฉ ุชุฑุงฺฉูุด ูุงุญุฏ** ุฏุฏู ูโุดูุฏ. ุงฺฏุฑ ุฏุฑ ุฑุฏู ต ูููู ุฎุทุง ุฑุฎ ุฏูุฏุ ฺฉู ต ูููู ุฑุฏู ูุจู `ROLLBACK` ูโุดููุฏ ู ุฏุชุงุจุณ ุชูุฒ ูโูุงูุฏ. ุงูุง ุฏุฑ ุฑูุดโูุง ุนุงุฏ (`INSERT` ุง `mysqldump`)ุ ุงฺฏุฑ ูุณุท ฺฉุงุฑ ุฎุทุง ุฑุฎ ุฏูุฏุ ุฑุฏูโูุง ูุจู ุฏุฑ ุฏุชุงุจุณ ุจุงู ูโูุงููุฏ (Partial Import) ฺฉู ูุฏุฑุช ุขู ุฏุดูุงุฑ ุงุณุช.

#### ุชุบุฑ ุณุงุฎุชุงุฑ (Schema) ุฌุฏุงูู ุบููโูพฺฉุฑ
ฺฉ ุฏุณุชูุฑ `ALTER TABLE` ุณุงุฏู (ูุงููุฏ ุงูุฒูุฏู ฺฉ ุณุชูู ุฌุฏุฏ) ุฑู ุฌุฏูู ุจุง ตฐฐ ูููู ุฑุฏูุ ูโุชูุงูุฏ ุฌุฏูู ุฑุง ุจุฑุง ุณุงุนุชโูุง ููู ฺฉุฑุฏู ู ุจุงุนุซ ุงุฒ ุฏุณุชุฑุณ ุฎุงุฑุฌ ุดุฏู ฺฉุงูู ุงูพูฺฉุดู ุดูุง ุดูุฏ (Downtime).

**ุฑุงูโุญู: ุงุจุฒุงุฑูุง Online Schema Change**
ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุงู ูุงุฌุนูุ ูุฑฺฏุฒ `ALTER TABLE` ุฑุง ูุณุชููุงู ุฑู ุฌุฏุงูู ุจุฒุฑฺฏ ุฏุฑ ูุญุท Production ุงุฌุฑุง ูฺฉูุฏ. ุจู ุฌุง ุขู ุงุฒ ุงุจุฒุงุฑูุง ุชุฎุตุต ูุงููุฏ **`pt-online-schema-change`** (ุงุฒ ูุฌููุนู Percona) ุง **`gh-ost`** (ุณุงุฎุชู ุดุฏู ุชูุณุท GitHub) ุงุณุชูุงุฏู ฺฉูุฏ.

**ุงู ุงุจุฒุงุฑูุง ฺฺฏููู ฺฉุงุฑ ูโฺฉููุฏุ**
1.  ฺฉ ฺฉูพ ุฎุงู ุงุฒ ุฌุฏูู ุดูุง ุจุง ุณุงุฎุชุงุฑ ุฌุฏุฏ ูโุณุงุฒูุฏ (ุฌุฏูู ุฑูุญ).
2.  ุดุฑูุน ุจู ฺฉูพ ฺฉุฑุฏู ุฏุงุฏูโูุง ุจู ุตูุฑุช ุฏุณุชูโุง ุงุฒ ุฌุฏูู ุงุตู ุจู ุฌุฏูู ุฌุฏุฏ ูโฺฉููุฏ.
3.  ุจุง ุงุณุชูุงุฏู ุงุฒ ุชุฑฺฏุฑูุงุ ุชูุงู ุชุบุฑุงุช (`INSERT`, `UPDATE`, `DELETE`) ฺฉู ุฏุฑ ุญู ุนููุงุช ุฑู ุฌุฏูู ุงุตู ุงุนูุงู ูโุดูุฏ ุฑุง ุฑู ุฌุฏูู ุฌุฏุฏ ูุฒ ุงุนูุงู ูโฺฉููุฏ.
4.  ููุช ุฏู ุฌุฏูู ฺฉุงููุงู ููฺฏุงู ุดุฏูุฏุ ุฏุฑ ฺฉ ูุญุธู ู ุจู ุตูุฑุช ุงุชูุ ูุงู ุฌุฏูู ุงุตู ุฑุง ุจุง ุฌุฏูู ุฌุฏุฏ ุฌุงุจุฌุง ูโฺฉููุฏ.

ุงู ูุฑุขูุฏ ูพฺุฏูุ ุชุบุฑุงุช ุฑุง ุจุฏูู ููู ฺฉุฑุฏู ุฌุฏูู ู ุจุง ฺฉูุชุฑู ุชุฃุซุฑ ุจุฑ ุนููฺฉุฑุฏ ุณุณุชู ุงุนูุงู ูโฺฉูุฏ.

---


## ฒ. ุฏุฑฺฉ ูููโฺฏุฐุงุฑ (Locking) ู Deadlocks

ุจุฑุง ุญูุธ ฺฉูพุงุฑฺฺฏุ InnoDB ุงุฒ **Row-Level Locking** ุงุณุชูุงุฏู ูโฺฉูุฏ. ุงูุง ฺฏุงู ุชุฏุงุฎู ูููโูุง ููุฌุฑ ุจู **Deadlock (ุจูโุจุณุช)** ูโุดูุฏ.

**ุจูโุจุณุช** ุฒูุงู ุฑุฎ ูโุฏูุฏ ฺฉู ุฏู ุชุฑุงฺฉูุด ุฏุฑ ฺฉ **ฺุฑุฎู** ฺฏุฑ ูโฺฉููุฏ: ุชุฑุงฺฉูุด A ููุชุธุฑ ููุจุน ุงุณุช ฺฉู ุฏุณุช B ุงุณุชุ ู B ููุชุธุฑ ููุจุน ุงุณุช ฺฉู ุฏุณุช A ุงุณุช. ูฺโฺฉุฏุงู ููโุชูุงููุฏ ุงุฏุงูู ุฏููุฏ.
*(ุฏูุช ฺฉูุฏ: ุงฺฏุฑ ฺูุฏ ุชุฑุงฺฉูุด ููุท ฺฉ ุฑุฏู ูุดุชุฑฺฉ ุฑุง ุจุฎูุงููุฏุ Deadlock ูุณุชุ ุจูฺฉู "Lock Wait" ุง ุตู ุงูุชุธุงุฑ ุงุณุช).*

**ูฺฉุงูุณู ุฏูุงุน InnoDB:**
ุฏุชุงุจุณ ุจู ุตูุฑุช ููุดููุฏ ฺุฑุฎู ุฑุง ุชุดุฎุต ุฏุงุฏู ู ุจูุงูุงุตูู ฺฉ ุงุฒ ุชุฑุงฺฉูุดโูุง ุฑุง ุจู ุนููุงู "ูุฑุจุงู" ุงูุชุฎุงุจ ู `ROLLBACK` ูโฺฉูุฏ ุชุง ุจูู ุขุฒุงุฏ ุดููุฏ.

### ุงุณุชุฑุงุชฺ ุจุฑุฎูุฑุฏ ุฏุฑ ุงูพูฺฉุดู (Retry Logic) ๐

ููุช ุฏุชุงุจุณ ฺฉ ุชุฑุงฺฉูุด ุฑุง ูุฑุจุงู ูโฺฉูุฏุ ุงุฑูุฑ ุดูุงุฑู **`1213`** ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ.
ุงุฒ ุขูุฌุง ฺฉู Deadlock ฺฉ ูุดฺฉู ูููุช ุงุณุช (ุงฺฏุฑ ฺูุฏ ููโุซุงูู ุจุนุฏ ุชูุงุด ฺฉูุฏ ูููโูุง ุขุฒุงุฏ ุดุฏูโุงูุฏ)ุ ุฑุงูโุญู ุงุณุชุงูุฏุงุฑุฏ **ุชูุงุด ูุฌุฏุฏ (Retry)** ุงุณุช.

**ููุทู ุตุญุญ ุฏุฑ ฺฉุฏููุณ:**
ุจู ุฌุง ูุดุงู ุฏุงุฏู ุฎุทุง ุจู ฺฉุงุฑุจุฑุ ุงูพูฺฉุดู ุจุงุฏ ฺฉุฏ ุฎุทุง ุฑุง ุจุฑุฑุณ ฺฉูุฏ. ุงฺฏุฑ ุฎุทุง `1213` ุจูุฏุ ุจุงุฏ ุชุฑุงฺฉูุด ุฑุง ูุฌุฏุฏุงู ุงุฒ ุงุจุชุฏุง ุงุฌุฑุง ฺฉูุฏ. ุงฺฉุซุฑ ูุฑูโูุฑฺฉโูุง ูุฏุฑู ุงุจุฒุงุฑูุง ุจุฑุง ุงูุฌุงู ุฎูุฏฺฉุงุฑ ุงู ฺฉุงุฑ ุฏุงุฑูุฏ.

### ุฏุจุงฺฏ ฺฉุฑุฏู

ุงฺฏุฑ ุฎุทุง `Deadlock found` ุฑุง ุฏุฑ ูุงฺฏโูุง ุฎูุฏ ุฒุงุฏ ูโุจูุฏุ ุจุงุฏ ููุทู ฺฉูุฆุฑโูุงุชุงู ุฑุง ุจุฑุฑุณ ฺฉูุฏ. ุจุง ุฏุณุชูุฑ ุฒุฑ ุขุฎุฑู Deadlock ุฑุฎ ุฏุงุฏู ุฑุง ุชุญูู ฺฉูุฏ ุชุง ุจูููุฏ ฺฉุฏุงู ฺฉูุฆุฑโูุง ุจุง ูู ุชุฏุงุฎู ุฏุงุฑูุฏ:

<div dir="ltr">

```sql
SHOW ENGINE INNODB STATUS;
```
</div>

ุฏุฑ ุฎุฑูุฌ ุทููุงู ุงู ุฏุณุชูุฑุ ุจุฎุด ุจู ูุงู `LATEST DETECTED DEADLOCK` ูุฌูุฏ ุฏุงุฑุฏ ฺฉู ุจู ุดูุง ูุดุงู ูโุฏูุฏ ฺฉุฏุงู ฺฉูุฆุฑโูุง ู ฺฉุฏุงู ุชุฑุงฺฉูุดโูุง ุฏุฑฺฏุฑ ุจูุฏูโุงูุฏ. ุงู ุงุทูุงุนุงุช ุจุฑุง ุงุตูุงุญ ููุทู ฺฉุฏ ุดูุง ุญุงุช ุงุณุช.

---
[โฉ ุฏุฑุณ ูุจู: ููุงุณโูพุฐุฑ](../03-Scalability/README.md) | [๐ผ ุจุงุฒฺฏุดุช ุจู ููุฑุณุช ูุตู](../README.md) | [๐ ูุดุงูุฏู ููููู ฺฉุฏ](examples.sql) | [ูุตู ุจุนุฏ: ฺฉูพุงุฑฺูโุณุงุฒ ุจุง ูุงุฑุงูู โช](../../05-Laravel-Integration/README.md)

</div>