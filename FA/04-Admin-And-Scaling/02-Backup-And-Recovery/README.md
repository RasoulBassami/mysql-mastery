<div dir="rtl">

# ุจุฎุด ดุ ุฏุฑุณ ฒ: ูพุดุชุจุงูโฺฏุฑ ู ุจุงุฒุงุจ (Backup & Recovery)

ุฏุงุฏูโูุง ุงุฑุฒุดููุฏุชุฑู ุฏุงุฑุง ูุฑ ุงูพูฺฉุดู ูุณุชูุฏ. ฺฉ ุจุงฺฏ ุฏุฑ ฺฉุฏ ุฑุง ูโุชูุงู ุงุตูุงุญ ฺฉุฑุฏุ ุงูุง ุฏุงุฏูโุง ฺฉู ุจุฑุง ููุดู ุงุฒ ุฏุณุช ุฑูุชูุ ูุงุจู ุฌุงฺฏุฒู ูุณุช. ูพุดุชุจุงูโฺฏุฑ (Backup) ุชููุง ุฑุงู ูุฌุงุช ุดูุง ุฏุฑ ุจุฑุงุจุฑ ุฎุฑุงุจ ุณุฎุชโุงูุฒุงุฑุ ุงุดุชุจุงูุงุช ุงูุณุงู (ฺฉ ุฏุณุชูุฑ `DELETE` ุจุฏูู `WHERE`) ุง ุญููุงุช ูุฎุฑุจ ุงุณุช.

> **ูุงููู ุทูุง:** ฺฉ ุงุณุชุฑุงุชฺ ูพุดุชุจุงูโฺฏุฑุ ุจุฏูู ฺฉ ุจุฑูุงูู ุจุงุฒุงุจู ุชุณุชโุดุฏูุ ุจโูุนูุงุณุช. ุจฺฉโุขูพ ฺฉู ูุชูุงูุฏ ุขู ุฑุง ุจุงุฒุงุจ ฺฉูุฏุ ููุท ฺฉ ูุงู ุจโูุตุฑู ุงุณุช.

-----

## ุงููุงุน ูพุดุชุจุงูโฺฏุฑ: ููุทู ุฏุฑ ููุงุจู ูุฒฺฉ

ุฏู ุฑูฺฉุฑุฏ ุงุตู ุจุฑุง ูพุดุชุจุงูโฺฏุฑ ุงุฒ ุฏุชุงุจุณ ูุฌูุฏ ุฏุงุฑุฏ:

### ฑ. ูพุดุชุจุงูโฺฏุฑ ููุทู (Logical Backup)

ุฏุฑ ุงู ุฑูุดุ ุงุฒ ุฏุชุงุจุณ ฺฉ ุฎุฑูุฌ ุฏุฑ ูุงูุจ ุฏุณุชูุฑุงุช SQL (ูุงููุฏ `... CREATE TABLE` ุง  `... INSERT INTO`) ฺฏุฑูุชู ูโุดูุฏ. ุงู ุฎุฑูุฌ ฺฉ ูุงู ูุชู ุจุฒุฑฺฏ ู ูุงุจู ุฎูุงูุฏู ุงุณุช.

* **ุงุจุฒุงุฑ ุงุตู:** `mysqldump`
* **ูุฒุงุง:**
  * **ุจุณุงุฑ ููุนุทู:** ูโุชูุงูุฏ ุขู ุฑุง ุฑู ูุณุฎูโูุง ูุฎุชูู MySQLุ ุณุฎุชโุงูุฒุงุฑูุง ูุชูุงูุช ุง ุญุช ุณุณุชูโูุง ุฏุชุงุจุณ ุฏฺฏุฑ (ุจุง ฺฉู ุชุบุฑ) ุจุงุฒุงุจ ฺฉูุฏ.
  * **ูุงุจู ุฎูุงูุฏู:** ูโุชูุงูุฏ ูุงู ุจฺฉโุขูพ ุฑุง ุจุงุฒ ฺฉุฑุฏู ู ูุญุชูุง ุขู ุฑุง ุจุจูุฏ ุง ุญุช ูุฑุงุด ฺฉูุฏ.
* **ูุนุงุจ:**
  * **ุจุงุฒุงุจ ฺฉูุฏุชุฑ:** ุจุฑุง ุจุงุฒุงุจุ MySQL ุจุงุฏ ุชูุงู ุฏุณุชูุฑุงุช SQL ุฑุง ุฎุท ุจู ุฎุท ุงุฌุฑุง ฺฉูุฏ ฺฉู ุฒูุงูโุจุฑ ุงุณุช.
  * ุจุฑุง ุฏุชุงุจุณโูุง ุจุณุงุฑ ุจุฒุฑฺฏ (ุตุฏูุง ฺฏฺฏุงุจุงุช) ููฺฉู ุงุณุช ูุฑุขูุฏ ุจฺฉโุขูพ ฺฏุฑูุชู ฺฉูุฏ ุจุงุดุฏ.

### ฒ. ูพุดุชุจุงูโฺฏุฑ ูุฒฺฉ (Physical Backup)

ุฏุฑ ุงู ุฑูุดุ ุจู ุฌุง ฺฏุฑูุชู ุฎุฑูุฌ SQLุ ูุณุชููุงู ูุงูโูุง ุจุงูุฑ ฺฉู ุฏุชุงุจุณ ุฏุงุฏูโูุง ุฑุง ุฏุฑ ุขูโูุง ุฐุฎุฑู ูโฺฉูุฏุ ฺฉูพ ูโุดููุฏ.

* **ุงุจุฒุงุฑ ุงุตู:** Percona XtraBackup (ุงุจุฒุงุฑ ูุชูโุจุงุฒ ูุญุจูุจ)
* **ูุฒุงุง:**
  * **ุจุณุงุฑ ุณุฑุน:** ูู ูุฑุขูุฏ ุจฺฉโุขูพ ู ูู ุจุงุฒุงุจ ุจุณุงุฑ ุณุฑุนโุชุฑ ุงุฒ ุฑูุด ููุทู ุงุณุชุ ฺูู ููุท ูุงูโูุง ฺฉูพ ูโุดููุฏ.
* **ูุนุงุจ:**
  * **ุงูุนุทุงูโูพุฐุฑ ฺฉูุชุฑ:** ูุนูููุงู ุจุงุฏ ุฑู ููุงู ูุณุฎู MySQL ู ุณุณุชูโุนุงูู ูุดุงุจู ุจุงุฒุงุจ ุดูุฏ.
  * **ุบุฑูุงุจู ุฎูุงูุฏู:** ูุงูโูุง ุจุงูุฑ ู ุจุฑุง ุงูุณุงู ุบุฑูุงุจู ููู ูุณุชูุฏ.

**ฺฉุฏุงู ุฑุง ุงูุชุฎุงุจ ฺฉููุ** ุจุฑุง ุงฺฉุซุฑ ุงูพูฺฉุดูโูุง ฺฉูฺฺฉ ุชุง ูุชูุณุท (ุฒุฑ ฑฐ-ฒฐ ฺฏฺฏุงุจุงุช)ุ `mysqldump` ฺฉุงููุงู ฺฉุงูุ ุณุงุฏู ู ูุงุจู ุงุนุชูุงุฏ ุงุณุช.

-----

## ฺฉุงุฑ ุจุง ุงุจุฒุงุฑ ูุฏุฑุชููุฏ `mysqldump`

ุงู ุงุจุฒุงุฑ ุฎุท ูุฑูุงูุ ฺุงูู ุณูุฆุณ ุดูุง ุจุฑุง ูพุดุชุจุงูโฺฏุฑ ููุทู ุงุณุช.

**ูููโุชุฑู ุขูพุดูโูุง ฺฉู ุจุงุฏ ุจุดูุงุณุฏ:**

* ุข) `single-transaction`: **ุญุงุช ุจุฑุง ุฌุฏุงูู InnoDB.** ุงู ุขูพุดู ุชุถูู ูโฺฉูุฏ ฺฉู ฺฉ ุจฺฉโุขูพ ุณุงุฒฺฏุงุฑ (Consistent) ุงุฒ ูุถุนุช ุฏุชุงุจุณ ุฏุฑ ฺฉ ูุญุธู ุฎุงุต ฺฏุฑูุชู ุดูุฏุ **ุจุฏูู ุงูฺฉู ุฌุฏุงูู ููู ุดููุฏ** ู ุงูพูฺฉุดู ุงุฒ ฺฉุงุฑ ุจูุชุฏ.
* ุจ) `quick`: ุจุฑุง ุฏุชุงุจุณโูุง ุจุฒุฑฺฏ ุญุงุช ุงุณุช. ุจุฏูู ุงู ฺฏุฒููุ `mysqldump` ุณุน ูโฺฉูุฏ ฺฉู ุฌุฏูู ุฑุง ุฏุฑ RAM ููุฏ ฺฉูุฏ ฺฉู ูโุชูุงูุฏ ุณุฑูุฑ ุฑุง ฺฉุฑุด ฺฉูุฏ. ุงู ฺฏุฒูู ูโฺฏูุฏ "ุฑุฏูโูุง ุฑุง ฺฉโฺฉ ุจุฎูุงู ู ุจููุณ".
* ูพ) `routines` ู `triggers`: ุจุฑุง ุงูฺฉู ููุทู ุฏุชุงุจุณ (Stored Procedures ู Triggers) ุฌุง ููุงูุฏ.
* ุช) `no-data`: ููุท ุณุงุฎุชุงุฑ (Schema) ุฌุฏุงูู ุฑุง ุจุฏูู ุฏุงุฏูโูุง ุฎุฑูุฌ ูโุฏูุฏ.

### ๐ ุฏุณุชูุฑ ุทูุง: ุจฺฉโุขูพ ุจููู ู ูุดุฑุฏู

ุจุฑุง ฺฉ ุฏุชุงุจุณ ฺูุฏ ฺฏฺฏุงุจุงุชุ ุฏุณุชูุฑ ุฒุฑ ุจูุชุฑู ุงูุชุฎุงุจ ุงุณุช. ุงู ุฏุณุชูุฑ ุจฺฉโุขูพ ุฑุง ูโฺฏุฑุฏุ ูุดุฑุฏู ูโฺฉูุฏ (ุจุง `gzip`) ู ูุงู ูุงู ุฑุง ุจุฑ ุงุณุงุณ ุชุงุฑุฎ ุฑูุฒ ูโุณุงุฒุฏ.

<div dir="ltr">

```bash
  mysqldump -u root -p \
      --single-transaction \
      --quick \
      --routines \
      --triggers \
      my_database_name | gzip > backup_$(date +%F).sql.gz
```

</div>

* **ฺุฑุง `gzip`ุ** ูุงูโูุง SQL ูุชู ูุณุชูุฏ ู ุจู ุดุฏุช ูุดุฑุฏู ูโุดููุฏ (ูุนูููุงู ฑ ุจู ฑฐ). ฺฉ ุฏุชุงุจุณ ณ ฺฏฺฏุงุจุงุช ุจู ณฐฐ ูฺฏุงุจุงุช ุชุจุฏู ูโุดูุฏ ฺฉู ุฐุฎุฑู ู ุงูุชูุงู ุขู ุจุณุงุฑ ุณุฑุนโุชุฑ ุงุณุช.

### โ๏ธ ุงูุชูุงู ูุณุชูู ุจู ุณุฑูุฑ ุฏฺฏุฑ (ุจุฏูู ุฐุฎุฑู ูุญู)

ุงฺฏุฑ ูุถุง ฺฉุงู ุฑู ุณุฑูุฑ ุงุตู ูุฏุงุฑุฏ ุง ูโุฎูุงูุฏ I/O ุฏุณฺฉ ุฑุง ฺฉุงูุด ุฏูุฏุ ูโุชูุงูุฏ ุจฺฉโุขูพ ุฑุง ูุณุชููุงู ุฑู ฺฉ ุณุฑูุฑ ุฏฺฏุฑ (Backup Server) ุงุณุชุฑู ฺฉูุฏ:

<div dir="ltr">

```bash
  mysqldump -u root -p --single-transaction --quick my_db | gzip | ssh user@backup_server_ip "cat > /path/to/backups/backup_$(date +%F).sql.gz"
```

</div>
ุงู ุฑูุด ูููโุงูุนุงุฏู ุญุฑููโุง ุงุณุช ฺูู ุญุช ฺฉ ุจุงุช ูู ุฑู ูุงุฑุฏ ุฏุณฺฉ ุณุฑูุฑ ุงุตู ููุดุชู ููโุดูุฏ.

-----

### ุงุณุชุฑุงุชฺ ูพุดุชุจุงูโฺฏุฑ ู ฺุฑุฎุด (Rotation Policy)

> **โ๏ธ ูุดุฏุงุฑ ูุฑฺฏุจุงุฑ:** ูุฑฺฏุฒ ูุงู ุจฺฉโุขูพ ุฌุฏุฏ ุฑุง ุฌุงฺฏุฒู (Replace) ูุงู ูุจู ูฺฉูุฏ\!

ุงฺฏุฑ ุฏุชุงุจุณ ุดูุง ุงูุฑูุฒ ุฎุฑุงุจ ุดูุฏ ู ุดูุง ุฑู ููุงู ุจฺฉโุขูพ ุณุงููู ุฏุฑูุฒุ ุจฺฉโุขูพู ุฎุฑุงุจู ุงูุฑูุฒ ุฑุง ุฐุฎุฑู ฺฉูุฏุ ุฏุงุฏูโูุง ุดูุง **ุจุฑุง ููุดู ูุงุจูุฏ ุดุฏูโุงูุฏ**.

**ุฑุงูโุญู ุตุญุญ (Rotation):**
ุดูุง ุจุงุฏ ฺูุฏู ูุณุฎู ุงุฒ ุจฺฉโุขูพโูุง ุฑุง ูฺฏู ุฏุงุฑุฏ (ูุซูุงู ท ุจฺฉโุขูพ ุฑูุฒุงูู ู ด ุจฺฉโุขูพ ููุชฺฏ). ฺฉ ุงุณฺฉุฑูพุช ุณุงุฏู ูโุชูุงูุฏ ูุงูโูุง ูุฏู ุฑุง ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ูพุงฺฉ ฺฉูุฏ:

<div dir="ltr">

```bash
  # exmaple : ุญุฐู ูุงูโูุง ุจฺฉโุขูพ ูุฏูโุชุฑ ุงุฒ ท ุฑูุฒ
  find /path/to/backups -name "*.sql.gz" -mtime +7 -delete
```

</div>

**ุฏุณุชูุฑ ุจุงุฒุงุจ (Restore) ฺฉ ุจฺฉโุขูพ ูุดุฑุฏู:**

<div dir="ltr">

```bash
  gunzip < backup.sql.gz | mysql -u [username] -p [database_name]
```

</div>

---
[โฉ ุฏุฑุณ ูุจู: ุงููุช](../01-Security/README.md) | [๐ผ ุจุงุฒฺฏุดุช ุจู ููุฑุณุช ูุตู](../README.md) | [๐ ูุดุงูุฏู ููููู ฺฉุฏ](examples.sh) | [ุฏุฑุณ ุจุนุฏ: ููุงุณโูพุฐุฑ โช](../03-Scalability/README.md)

</div>
