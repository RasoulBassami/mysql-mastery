<div dir="rtl">

# ุจุฎุด ถุ ุฏุฑุณ ณ: ููุดุชู ฺฉูุฆุฑโูุง ุจููู ู ุงูู ุจุง ฺฉูุงุณ `wpdb$`

ุชูุงุจุน ุงุณุชุงูุฏุงุฑุฏ ูุฑุฏูพุฑุณ ูุงููุฏ `WP_Query` ุง `get_posts` ุจุฑุง ธฐูช ฺฉุงุฑูุง ุฑูุฒูุฑู ุนุงู ูุณุชูุฏ. ุขูโูุง ุงูู ูุณุชูุฏ ู ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุงุฒ ุณุณุชู ฺฉุด ูุฑุฏูพุฑุณ ุงุณุชูุงุฏู ูโฺฉููุฏ. ุงูุง ฺฏุงู ุงููุงุช ุดูุง ูุงุฒ ุจู ุงุฌุฑุง ฺฉูุฆุฑโูุง ุณูุงุฑุดุ ูพฺุฏู ุง ุจุณุงุฑ ุจููู ุฏุงุฑุฏ. ุงูุฌุงุณุช ฺฉู ุจุงุฏ ูุณุชููุงู ุจุง ุฏุชุงุจุณ ุตุญุจุช ฺฉูุฏ ู ุงุจุฒุงุฑ ูุฑุฏูพุฑุณ ุจุฑุง ุงู ฺฉุงุฑุ ุขุจุฌฺฉุช ฺฏููุจุงู `wpdb$` ุงุณุช.

### ## ฺฉูุงุณ `wpdb$` ฺุณุชุ

ฺฉูุงุณ `wpdb$` ฺฉ ฺฉูุงุณ ุงูุชุฒุงุน ุฏุชุงุจุณ (Database Abstraction Layer) ุฏุฑ ูุฑุฏูพุฑุณ ุงุณุช ฺฉู ุจู ุดูุง ฺฉ ุฑุงุจุท ุงูู ู ุฑุงุญุช ุจุฑุง ุงุฌุฑุง ูุฑ ููุน ฺฉูุฆุฑ SQL ูโุฏูุฏ.

#### ฺู ุฒูุงู ุงุฒ `wpdb$` ุงุณุชูุงุฏู ฺฉููุ
* ุจุฑุง ุณุงุฎุช ฺฏุฒุงุฑุดโูุง ูพฺุฏู ฺฉู ูุงุฒ ุจู `JOIN` ูุง ุณูุงุฑุด ุจู ุฌุฏุงูู ูุฎุชูู (ุจู ุฎุตูุต ุฌุฏุงูู ุณูุงุฑุด ูพูุงฺฏูโูุง) ุฏุงุฑูุฏ.
* ุจุฑุง ุงุฌุฑุง ุนููุงุช ุฏุณุชูโุง `UPDATE` ุง `DELETE` ุฌูุช ุจูุจูุฏ ุนููฺฉุฑุฏ.
* ููฺฏุงู ฺฉุงุฑ ุจุง ุฌุฏุงูู ุณูุงุฑุด ฺฉู ุณุงุฎุชุงุฑ ุงุณุชุงูุฏุงุฑุฏ ูพุณุชโูุง ุง ฺฉุงุฑุจุฑุงู ูุฑุฏูพุฑุณ ุฑุง ุฏูุจุงู ููโฺฉููุฏ.

---

### ## ูููโุชุฑู ูุชุฏูุง `wpdb$`

ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ุงู ฺฉูุงุณุ ุจุงุฏ ุงุฒ ูุชุบุฑ ฺฏููุจุงู `wpdb$` ุฏุฑ ฺฉุฏ ุฎูุฏ ุงุณุชูุงุฏู ฺฉูุฏ.
<div dir="ltr">

```php
global $wpdb;
```

</div>

* ุข) `()wpdb->get_results$`: ุจุฑุง ุงุฌุฑุง ฺฉ ฺฉูุฆุฑ `SELECT` ฺฉู ุงูุชุธุงุฑ ุฏุงุฑุฏ **ฺูุฏู ุฑุฏู** ุฑุง ุจุฑฺฏุฑุฏุงูุฏ. ุฎุฑูุฌ ุขู ุขุฑุงูโุง ุงุฒ ุขุจุฌฺฉุชโูุงุณุช.
* ุจ) `()wpdb->get_row$`: ุจุฑุง ฺฉูุฆุฑ `SELECT` ฺฉู ููุท **ฺฉ ุฑุฏู** ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ.
* ูพ) `()wpdb->get_var$`: ุจุฑุง ุฒูุงู ฺฉู ููุท ุจู **ฺฉ ููุฏุงุฑ ูุงุญุฏ** ุงุฒ ฺฉ ุฑุฏู ูุงุฒ ุฏุงุฑุฏ (ูุซูุงู `(*)COUNT`).
* ุช)  `()wpdb->query$`: ุจุฑุง ุฏุณุชูุฑุงุช ฺฉู ูุชุฌูโุง ุจุฑููโฺฏุฑุฏุงููุฏุ ูุงููุฏ `INSERT`, `UPDATE`, `DELETE`. ุงู ูุชุฏ ุชุนุฏุงุฏ ุฑุฏูโูุง ุชุญุช ุชุฃุซุฑ ูุฑุงุฑ ฺฏุฑูุชู ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ.

---

### ## ุงููุช ุฏุฑ ุงูููุช: ุงุณุชูุงุฏู ุงุฒ `()wpdb->prepare$`

ูููโุชุฑู ูุงููู ฺฉู ููฺฏุงู ฺฉุงุฑ ุจุง `wpdb$` ุจุงุฏ ุจู ุขู ูพุงุจูุฏ ุจุงุดุฏ ุงู ุงุณุช:
> **ูุฑฺฏุฒุ ูุฑฺฏุฒ ู ูุฑฺฏุฒ** ูุชุบุฑูุง ูุฑูุฏ (ูุงููุฏ `GET_$` ุง `POST_$`) ุฑุง ูุณุชููุงู ุฏุฑ ุฑุดุชู ฺฉูุฆุฑ ุฎูุฏ ุงูุญุงู (concatenate) ูฺฉูุฏ. ุงู ฺฉุงุฑ ุจุฒุฑฺฏุชุฑู ุญูุฑู ุงููุช SQL Injection ุฑุง ุงุฌุงุฏ ูโฺฉูุฏ.

ุฑุงูโุญู ูุฑุฏูพุฑุณ ุจุฑุง ุงู ูุดฺฉูุ ูุชุฏ `()wpdb->prepare$` ุงุณุช. ุงู ูุชุฏ ูุงููุฏ `sprintf` ุนูู ฺฉุฑุฏู ู ุงุฒ placeholder ูุง ุจุฑุง ุฌุงฺฏุฒู ุงูู ููุงุฏุฑ ุงุณุชูุงุฏู ูโฺฉูุฏ.

* ุจุฑุง ุฑุดุชูโูุง `s%` (string)
* ุจุฑุง ุงุนุฏุงุฏ ุตุญุญ `d%` (integer)
* ุจุฑุง ุงุนุฏุงุฏ ุงุนุดุงุฑ `f%` (float)

**ููุงุณู ฺฉุฏ ูุงุงูู ู ุงูู:**

**โ ฺฉุฏ ูุงุฌุนูโุจุงุฑ (ุขุณุจโูพุฐุฑ):**
<div dir="ltr">

```php
$user_id = $_GET['id']; // '1 OR 1=1' ฺฉุงุฑุจุฑ ูโุชูุงูุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ
$user_posts = $wpdb->get_results("SELECT * FROM $wpdb->posts WHERE post_author = $user_id");
```
</div>

**โ ฺฉุฏ ุตุญุญ ู ุงูู:**
<div dir="ltr">

```php
$user_id = $_GET['id'];
$user_posts = $wpdb->get_results( $wpdb->prepare(
    "SELECT * FROM $wpdb->posts WHERE post_author = %d",
    $user_id
) );
```
</div>

ุฏุฑ ูุณุฎู ุงููุ `()wpdb->get_results$` ุชุถูู ูโฺฉูุฏ ฺฉู ูุชุบุฑ `user_id$` ููุดู ุจู ุนููุงู ฺฉ ุนุฏุฏ ุชูุณุฑ ุดูุฏ ู ูฺ ฺฉุฏ ูุฎุฑุจ ูุงุจู ุชุฒุฑู ูุจุงุดุฏ.

---

### ## ูฺฉุงุช ูพุดุฑูุชู ู ุจูุชุฑู ุฑูุดโูุง

* **ููุดู ุงุฒ ูพุดููุฏ ุฌุฏุงูู ุงุณุชูุงุฏู ฺฉูุฏ:** ุจู ุฌุง ููุดุชู `wp_posts`ุ ุงุฒ `wpdb->posts$` ุงุณุชูุงุฏู ฺฉูุฏ. ุงู ุจุงุนุซ ูโุดูุฏ ฺฉุฏ ุดูุง ุฑู ุณุงุชโูุง ฺฉู ูพุดููุฏ ุฌุฏูู ูุชูุงูุช ุฏุงุฑูุฏ ูุฒ ฺฉุงุฑ ฺฉูุฏ.
* **ฺฉุด ฺฉุฑุฏู ูุชุงุฌ:** ุจุฑุฎูุงู `WP_Query`ุ ฺฉูุฆุฑโูุง `wpdb$` ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ฺฉุด ููโุดููุฏ. ุงฺฏุฑ ฺฉ ฺฉูุฆุฑ ุณูุงุฑุด ุณูฺฏู ุฏุงุฑุฏ ฺฉู ูุฑุชุจุงู ุงุฌุฑุง ูโุดูุฏุ **ุดูุง ูุณุฆูู ฺฉุด ฺฉุฑุฏู ูุชุงุฌ ุขู ูุณุชุฏ**. ุจูุชุฑู ุฑุงู ุจุฑุง ุงู ฺฉุงุฑ ุฏุฑ ูุฑุฏูพุฑุณุ ุงุณุชูุงุฏู ุงุฒ **Transients API** ุงุณุช.

---
[โฉ ุฏุฑุณ ูุจู: ูุดฺฉู Autoload ุฏุฑ wp_options](../02-wp-options-autoload/README.md) | [๐ผ ุจุงุฒฺฏุดุช ุจู ููุฑุณุช ูุตู](../README.md) | [๐ ูุดุงูุฏู ููููู ฺฉุฏ](examples.php) | [ุฏุฑุณ ุจุนุฏ: ูุดฺฉู EAV ุฏุฑ wp_postmeta โช](../04-postmeta-eav-problem/README.md)

</div>
