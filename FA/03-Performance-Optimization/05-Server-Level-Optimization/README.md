<div dir="rtl">

# ุจุฎุด ณุ ุฏุฑุณ ต: ุจูููโุณุงุฒ ุฏุฑ ุณุทุญ ุณุฑูุฑ (Server-Level Optimization)

ุฏุฑฺฉ ุชูุธูุงุช ุณุฑูุฑ ูุนูููุงู ูุธูู ูุฏุฑ ุฏุชุงุจุณ (DBA) ุง ุชู DevOps ุงุณุชุ ุงูุง ฺฉ ุชูุณุนูโุฏููุฏู ุงุฑุดุฏ ุจุงุฏ ุจุง ููุงูู ฺฉูุฏ ุขู ุขุดูุง ุจุงุดุฏ ุชุง ุจุชูุงูุฏ ูุดฺฉูุงุช ุนููโุชุฑ ุฑุง ุชุดุฎุต ุฏุงุฏู ู ุจุง ุชูโูุง ุฏฺฏุฑ ุจู ุตูุฑุช ูุคุซุฑ ุงุฑุชุจุงุท ุจุฑูุฑุงุฑ ฺฉูุฏ.

---

### ## ฺฉุงุฑุขฺฏุงู ุดูุง: ูุงฺฏ ฺฉูุฆุฑโูุง ฺฉูุฏ (Slow Query Log) ๐ต๏ธ

ุงู ูุงฺฏุ ูููโุชุฑู ุงุจุฒุงุฑ ุดูุง ุจุฑุง ูพุฏุง ฺฉุฑุฏู ูุดฺฉูุงุช ุนููฺฉุฑุฏ ุฏุฑ **ูุญุท ูุงูุน (Production)** ุงุณุช. `EXPLAIN` ุจุฑุง ุชุญูู ฺฉูุฆุฑโูุง ุงุณุช ฺฉู ุดูุง *ูฺฉุฑ ูโฺฉูุฏ* ฺฉูุฏ ูุณุชูุฏุ ุงูุง Slow Query Log ุจู ุดูุง ูโฺฏูุฏ ฺฉุฏุงู ฺฉูุฆุฑโูุง *ูุงูุนุงู* ุฏุฑ ุนูู ฺฉูุฏ ุงุฌุฑุง ูโุดููุฏ.

**ูุงฺฏ Slow Query ฺุณุชุ**
ฺฉ ูุงู ูุชู ุงุณุช ฺฉู MySQL ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑุ ฺฉูุฆุฑโูุง ุฑุง ฺฉู ุงุฌุฑุงุดุงู ุจุดุชุฑ ุงุฒ ุฒูุงู ูุดุฎุต ุทูู ฺฉุดุฏูุ ุฏุฑ ุขู ุซุจุช ูโฺฉูุฏ.

**ฺฺฏููู ุขู ุฑุง ูุนุงู ฺฉููุ**
ุจุงุฏ ฺูุฏ ูุชุบุฑ ุฑุง ุฏุฑ ูุงู ฺฉุงููฺฏ MySQL (`my.cnf`) ุชูุธู ฺฉูุฏ:

<div dir="ltr">

```ini
# (/etc/mysql/my.cnf ูุนูููุงู ุฏุฑ) my.cnf ูุงู 

[mysqld]
slow_query_log = 1
slow_query_log_file = /var/log/mysql/mysql-slow.log
long_query_time = 1  # ฺฉูุฆุฑโูุง ฺฉู ุจุด ุงุฒ ฑ ุซุงูู ุทูู ูโฺฉุดูุฏ ุฑุง ูุงฺฏ ฺฉู
```
</div>

ูพุณ ุงุฒ ุชุบุฑ ุงู ูุงูุ ุจุงุฏ ุณุฑูุณ MySQL ุฑุง ุฑโุงุณุชุงุฑุช ฺฉูุฏ.

**ฺฺฏููู ุขู ุฑุง ุชุญูู ฺฉููุ**
ุดูุง ูโุชูุงูุฏ ูุงู ูุงฺฏ ุฑุง ูุณุชููุงู ุจุฎูุงูุฏุ ุงูุง ุงุจุฒุงุฑ `mysqldumpslow` ฺฉู ููุฑุงู MySQL ูุตุจ ูโุดูุฏุ ฺฉุงุฑ ุฑุง ุจุณุงุฑ ุฑุงุญุชโุชุฑ ูโฺฉูุฏ. ุงู ุงุจุฒุงุฑ ูุงฺฏ ุฑุง ุชุญูู ฺฉุฑุฏู ู ฺฉ ุฎูุงุตู ููุฏ ุจู ุดูุง ูโุฏูุฏ.

<div dir="ltr">

```bash
#comment: ููุงุด ฑฐ ฺฉูุฆุฑ ฺฉูุฏ ุจุฑ ุงุณุงุณ ูุงูฺฏู ุฒูุงู ุงุฌุฑุง
mysqldumpslow -s at /var/log/mysql/mysql-slow.log | head -10
```
</div>

---

### ## ููุจ ุชูพูุฏู ุณุฑูุฑ: ูููโุชุฑู ูุชุบุฑูุง `my.cnf`

ูุงู `my.cnf` (ุฏุฑ ููุฏูุฒ `my.ini`) ูุฑฺฉุฒ ฺฉูุชุฑู ุณุฑูุฑ MySQL ุดูุงุณุช. ุฏุฑ ุญุงู ฺฉู ุตุฏูุง ูุชุบุฑ ุฏุฑ ุงู ูุงู ูุฌูุฏ ุฏุงุฑุฏุ ุชููุง ฺูุฏ ููุฑุฏ ุงุฒ ุขูโูุง ุจุดุชุฑู ุชุฃุซุฑ ุฑุง ุจุฑ ุนููฺฉุฑุฏ ุฏุงุฑูุฏ.

#### ูพุงุฏุดุงู ูุชุบุฑูุง `innodb_buffer_pool_size` ๐
ุงู **ูููโุชุฑู** ูุชุบุฑ ุจุฑุง ุนููฺฉุฑุฏ ููุชูุฑ InnoDB ุงุณุช. ุงู ูุชุบุฑ ูุดุฎุต ูโฺฉูุฏ ฺฉู InnoDB ฺู ููุฏุงุฑ ุงุฒ ุญุงูุธู **RAM** ุณุฑูุฑ ุฑุง ูโุชูุงูุฏ ุจุฑุง ฺฉุด ฺฉุฑุฏู **ุฏุงุฏูโูุง ู ุงูุฏฺฉุณโูุง** ุงุณุชูุงุฏู ฺฉูุฏ.

* **ุขูุงููฺ:** ุงู ูุชุบุฑ ูุงููุฏ ุงูุฏุงุฒู ูุฒ ฺฉุงุฑ ฺฉ ฺฉุชุงุจุฏุงุฑ ุงุณุช. ูุฑฺู ูุฒ ุจุฒุฑฺฏุชุฑ ุจุงุดุฏุ ฺฉุชุงุจุฏุงุฑ ูโุชูุงูุฏ ฺฉุชุงุจโูุง ูพุฑ ุงุณุชูุงุฏู ุจุดุชุฑ ุฑุง ุฑู ูุฒ ูฺฏู ุฏุงุฑุฏ (ุฏุฑ RAM) ู ูุงุฒ ฺฉูุชุฑ ุจู ุฑูุชู ุจู ููุณูโูุง (ุฏุณฺฉ) ุฎูุงูุฏ ุฏุงุดุช.
* **ูุงููู ฺฉู:** ุฏุฑ ุณุฑูุฑ ฺฉู ูุฎุชุต ุฏุชุงุจุณ ุงุณุชุ ุงู ููุฏุงุฑ ุฑุง ุจู **ตฐ ุชุง ทฐ ุฏุฑุตุฏ ฺฉู RAM ุณุฑูุฑ** ุชูุธู ูโฺฉููุฏ. ูุซูุงู ุจุฑุง ฺฉ ุณุฑูุฑ ุจุง ฑถ ฺฏฺฏุงุจุงุช ุฑูุ ููุฏุงุฑ `8G` ุง `10G` ุดุฑูุน ุฎูุจ ุงุณุช.

> **๐ก ูฺฉุชู ุนูู ุฏุฑ ููุฑุฏ ูุงููู ทฐูช:**
> ุญุงูุธู RAM ุนูุฏุชุงู ุจุฑุง *ุณุงุฎุชู* ูููุช B-Tree ูุง ุงุณุชูุงุฏู ููโุดูุฏุ ุจูฺฉู ุจุฑุง *ฺฉุด ฺฉุฑุฏู* (Caching) ุฏุงุฆู ุขูโูุง ุฏุฑ ุญู ฺฉุงุฑ ุฏุฑ ูุถุง ุจู ูุงู `innodb_buffer_pool` ุจู ฺฉุงุฑ ูโุฑูุฏ ุชุง ุงุฒ ุฎูุงูุฏู ฺฉูุฏ ุฏุณฺฉ ุฌููฺฏุฑ ุดูุฏ. ูุงููู ยซตฐ ุชุง ทฐ ุฏุฑุตุฏ ุฑู ุณุฑูุฑยป ฺฉ **ุณูู ุงูู** (Upper Bound) ุงุณุช ู ุฒูุงู ฺฉุงุฑุจุฑุฏ ุฏุงุฑุฏ ฺฉู ุฏุชุงุจุณ ุดูุง *ุจุฒุฑฺฏุชุฑ* ุงุฒ ุฑู ุจุงุดุฏ. ุงฺฏุฑ ุฏุชุงุจุณ ุดูุง (ุดุงูู ฺฉู ุฏุงุฏูโูุง ู ุงูุฏฺฉุณโูุง) *ฺฉูฺฺฉุชุฑ* ุงุฒ ุฑู ุณุฑูุฑ ุงุณุชุ ุงุฎุชุตุงุต ทฐูช ุฑู ูุฏุฑ ุฏุงุฏู ููุงุจุน ุงุณุชุ ุฏุฑ ุงู ุญุงูุชุ `innodb_buffer_pool_size` ุฑุง ุจู ููุฏุงุฑ **ฺฉู ุจุดุชุฑ ุงุฒ ุญุฌู ฺฉู ุฏุชุงุจุณ** ุฎูุฏ ุชูุธู ฺฉูุฏ ุชุง ฺฉู ุขู ุฏุฑ ุญุงูุธู ุฌุง ุดุฏู ู ุจู ุณุฑุนุช "in-memory" ุฏุณุช ุงุจุฏ. ุงฺฏุฑ ุฏุชุงุจุณ ุจุฒุฑฺฏุชุฑ ุงุฒ ุจุงูุฑ ูพูู ุจุงุดุฏุ InnoDB ุจู ุตูุฑุช ููุดููุฏ ยซูุฌููุนู ูุนุงูยป (Working Set) ุง ููุงู ุฏุงุฏูโูุง ูพุฑุงุณุชูุงุฏู ุฑุง ุฏุฑ ุฑู ฺฉุด ูโฺฉูุฏ ุชุง ุนููฺฉุฑุฏ ุณุฑุน ุจุงู ุจูุงูุฏ.

#### ูุชุบุฑ `innodb_log_file_size`
ุงู ูุชุบุฑ ุงูุฏุงุฒู ูุงูโูุง ูุงฺฏ ุชุฑุงฺฉูุด ุฑุง ูุดุฎุต ูโฺฉูุฏ. ุงู ูุงูโูุง ุจุฑุง ุจุงุฒุงุจ ูพุณ ุงุฒ ฺฉุฑุด ู ุงูุฒุงุด ุณุฑุนุช ุนููุงุช ููุดุชู (`INSERT`, `UPDATE`, `DELETE`) ุงุณุชูุงุฏู ูโุดููุฏ.
* **ุชุฃุซุฑ:** ูุงูโูุง ุจุฒุฑฺฏุชุฑ ูโุชูุงููุฏ ุนููฺฉุฑุฏ ููุดุชู ุฑุง ุฏุฑ ุณุณุชูโูุง ุดููุบ ุจูุจูุฏ ุจุฎุดูุฏุ ุงูุง ุฒูุงู ุจุงุฒุงุจ ูพุณ ุงุฒ ฺฉุฑุด ุฑุง ูุฒ ุทููุงูโุชุฑ ูโฺฉููุฏ. ููุฏุงุฑ `256M` ุง `512M` ูุนูููุงู ููุทู ุดุฑูุน ููุงุณุจ ุงุณุช.

#### ูุชุบุฑ `max_connections`
ุญุฏุงฺฉุซุฑ ุชุนุฏุงุฏ ุงุชุตุงูุงุช ููุฒูุงู ฺฉู ุณุฑูุฑ ูโูพุฐุฑุฏ.
* **ูุดุฏุงุฑ:** ุงู ููุฏุงุฑ ุฑุง ุจโุฏูู ุฒุงุฏ ูฺฉูุฏ! ูุฑ ุงุชุตุงู ููุฏุงุฑ ุงุฒ RAM ุฑุง ูุตุฑู ูโฺฉูุฏ. ุงฺฏุฑ ุงู ุนุฏุฏ ุจุด ุงุฒ ุญุฏ ุจุงูุง ุจุงุดุฏ ู ุชุนุฏุงุฏ ุฒุงุฏ ุงุชุตุงู ุจุฑูุฑุงุฑ ุดูุฏุ ููฺฉู ุงุณุช ุณุฑูุฑ ุจุง ฺฉูุจูุฏ ุญุงูุธู ููุงุฌู ุดุฏู ู ุงุฒ ฺฉุงุฑ ุจูุชุฏ. ุงู ููุฏุงุฑ ุจุงุฏ ุจุฑ ุงุณุงุณ ูุงุฒ ูุงูุน ุงูพูฺฉุดู ู ููุงุจุน ุณุฑูุฑ ุชูุธู ุดูุฏ.

#### ูุชุบุฑ `query_cache_size` (ูฺฉุชู ุชุงุฑุฎ)
* **ููู:** ุงู ูฺฺฏ ุฏุฑ ูุณุฎูโูุง ูุฏู MySQL ุจุฑุง ฺฉุด ฺฉุฑุฏู ูุชุงุฌ ฺฉูุฆุฑโูุง ุงุณุชูุงุฏู ูโุดุฏุ ุงูุง ุจู ุฏูู ูุดฺฉูุงุช ุนููฺฉุฑุฏ ู ุนุฏู ููุงุณโูพุฐุฑุ ุงุฒ ูุณุฎู **MySQL 5.7.7 ุจู ุจุนุฏ ููุณูุฎ (Deprecated) ุดุฏู ู ุฏุฑ MySQL 8.0 ุจู ุทูุฑ ฺฉุงูู ุญุฐู ุดุฏู ุงุณุช.**
* **ูุฑฺฏุฒ** ุฏุฑ ูุณุฎูโูุง ุฌุฏุฏ ุงู ูุชุบุฑ ุฑุง ูุนุงู ูฺฉูุฏ. ุฑูฺฉุฑุฏ ูุฏุฑูุ ุงุณุชูุงุฏู ุงุฒ **ฺฉุด ุฏุฑ ูุงู ุงูพูฺฉุดู** (ูุงููุฏ Redis) ุงุณุช.

### ููููู ูุงู ฺฉุงููฺฏ

ฺฉ ุจููฺฉ ููููู ุฏุฑ `my.cnf` ุจุฑุง ฺฉ ุณุฑูุฑ ุจุง ฑถ ฺฏฺฏุงุจุงุช ุฑู ูโุชูุงูุฏ ุจู ุงู ุดฺฉู ุจุงุดุฏ:

<div dir="ltr">

```ini
[mysqld]
# Slow Log Settings
slow_query_log        = 1
slow_query_log_file   = /var/log/mysql/mysql-slow.log
long_query_time       = 1

# Connection Settings
max_connections       = 150

# InnoDB Settings
innodb_buffer_pool_size = 10G
innodb_log_file_size    = 512M
innodb_file_per_table   = 1 # Best practice for managing tablespaces
```
</div>

### ุงุจุฒุงุฑูุง ฺฉูฺฉ
ุงุจุฒุงุฑูุง ูุงููุฏ **MySQLTuner** ุง **Percona Toolkit** ุงุณฺฉุฑูพุชโูุง ูุณุชูุฏ ฺฉู ูโุชูุงููุฏ ุณุฑูุฑ ุดูุง ุฑุง ุชุญูู ฺฉุฑุฏู ู ุจุฑ ุงุณุงุณ ุจุงุฑ ฺฉุงุฑ ูุนูุ ูพุดููุงุฏูุง ุจุฑุง ุจูุจูุฏ ุชูุธูุงุช `my.cnf` ุงุฑุงุฆู ุฏููุฏ. ุงู ุงุจุฒุงุฑูุง ุจุฑุง ุดุฑูุน ุนุงู ูุณุชูุฏ ุงูุง ูุจุงุฏ ุชูุตูโูุง ุขูโูุง ุฑุง ฺุดูโุจุณุชู ุงุฌุฑุง ฺฉุฑุฏ.

---
[โฉ ุฏุฑุณ ูุจู: ุจูููโุณุงุฒ ูุนูุงุฑ](../04-Architecture-Level-Optimization/README.md) | [๐ผ ุจุงุฒฺฏุดุช ุจู ููุฑุณุช ูุตู](../README.md) | [ูุตู ุจุนุฏ: ูุฏุฑุช ู ููุงุณโูพุฐุฑ โช](../../04-Admin-And-Scaling/README.md)

</div>
