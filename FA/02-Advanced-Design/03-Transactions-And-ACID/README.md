<div dir="rtl">

# ุจุฎุด ฒุ ุฏุฑุณ ณ: ุชุฑุงฺฉูุดโูุง (Transactions) ู ุฏุฑฺฉ ฺฉุงูู ููููู ACID

ุชุง ุจู ุญุงู ูฺฉุฑ ฺฉุฑุฏูโุงุฏ ฺฉ ุณุณุชู ุจุงูฺฉ ฺฺฏููู ุชุถูู ูโฺฉูุฏ ฺฉู ุฏุฑ ุนููุงุช ุงูุชูุงู ูุฌูุ ูพูู ุงุฒ ุญุณุงุจ ูุจุฏุฃ ฺฉู ุดุฏู ู **ุฏููุง ููุงู ููุฏุงุฑ** ุจู ุญุณุงุจ ููุตุฏ ุงุถุงูู ุดูุฏุ ฺู ุงุชูุงู ูโุงูุชุฏ ุงฺฏุฑ ุฏุฑุณุช ูุณุท ุงู ุนููุงุชุ ุณุฑูุฑ ุฎุงููุด ุดูุฏุ ุขุง ูพูู ูุงูพุฏุฏ ูโุดูุฏุ

ูพุงุณุฎ ุชูุงู ุงู ุณูุงูุงุช ุฏุฑ ููููู ุจู ูุงู **ุชุฑุงฺฉูุด** ูููุชู ุงุณุช. ุชุฑุงฺฉูุดุ ฺฉ ูฺฉุงูุฒู ูุฏุฑุชููุฏ ุฏุฑ ููุชูุฑ InnoDB ุงุณุช ฺฉู ุจู ุดูุง ุงุฌุงุฒู ูโุฏูุฏ ฺฉ ุง ฺูุฏ ุฏุณุชูุฑ SQL ุฑุง ุจู ุนููุงู ฺฉ **ูุงุญุฏ ฺฉุงุฑู ูููุฑุฏ ู ุชุฌุฒูโูุงูพุฐุฑ (Single unit of work)** ุงุฌุฑุง ฺฉูุฏ.

> **ูุงููู ุชุฑุงฺฉูุด:** ุง ุชูุงู ุฏุณุชูุฑุงุช ุฏุงุฎู ุขู ุจุง ููููุช ฺฉุงูู ุงุฌุฑุง ูโุดููุฏุ ุง ุฏุฑ ุตูุฑุช ุจุฑูุฒ ูุฑฺฏููู ุฎุทุงุ ูฺโฺฉุฏุงู ุงุฒ ุขูโูุง ุงุฌุฑุง ูุดุฏู ู ุฏุชุงุจุณ ุจู ุญุงูุช ุงููู ุฎูุฏ ุจุงุฒูโฺฏุฑุฏุฏ. (All or nothing)

---

## ฺูุงุฑ ุณุชูู ุงุตู ูุงุจูุช ุงุทููุงู (ACID)

ููููู ุชุฑุงฺฉูุด ุจุฑ ูพุงู ฺูุงุฑ ูฺฺฏ ุจูุง ุดุฏู ุงุณุช ฺฉู ุจู ุงุฎุชุตุงุฑ **ACID** ูุงูุฏู ูโุดููุฏ. ุฏุฑฺฉ ุงู ฺูุงุฑ ูฺฺฏ ุจุฑุง ูุฑ ุชูุณุนูโุฏููุฏู ุงุฑุดุฏ ุถุฑูุฑ ุงุณุช.

### 1. ุงุชู ุจูุฏู (Atomicity) โ๏ธ
ุงู ูฺฺฏ ุชุถูู ูโฺฉูุฏ ฺฉู ุชุฑุงฺฉูุด ุจู ุตูุฑุช "ุงุชู" ุง ุชุฌุฒูโูุงูพุฐุฑ ุงุณุช. ุนู ุง ุชูุงู ุนููุงุช ุขู (ูุซูุงู ฺฉู ฺฉุฑุฏู ุงุฒ ฺฉ ุญุณุงุจ ู ุงุถุงูู ฺฉุฑุฏู ุจู ุญุณุงุจ ุฏฺฏุฑ) ฺฉุงูู ุงูุฌุงู ูโุดูุฏุ ุง ูฺโฺฉุฏุงู ุงูุฌุงู ููโุดูุฏ. ฺุฒ ุจู ูุงู "ุชุฑุงฺฉูุด ูุตูู ู ููู" ูุฌูุฏ ูุฏุงุฑุฏ.

### 2. ุณุงุฒฺฏุงุฑ (Consistency) โ
ุงู ูฺฺฏ ุชุถูู ูโฺฉูุฏ ฺฉู ูุฑ ุชุฑุงฺฉูุดุ ุฏุชุงุจุณ ุฑุง ุงุฒ ฺฉ **ูุถุนุช ุณุงุฒฺฏุงุฑ (Consistent)** ุจู ฺฉ ูุถุนุช ุณุงุฒฺฏุงุฑ ุฏฺฏุฑ ููุชูู ูโฺฉูุฏ. ุฏุชุงุจุณ ููุงูู ู ูุญุฏูุฏุชโูุง ุฎูุฏ (ูุงููุฏ `FOREIGN KEY` ุง `NOT NULL`) ุฑุง ูุจู ู ุจุนุฏ ุงุฒ ุชุฑุงฺฉูุด ุญูุธ ูโฺฉูุฏ. ุจุฑุง ูุซุงูุ ฺฉ ุชุฑุงฺฉูุด ููโุชูุงูุฏ ููุฌุฑ ุจู ููู ุดุฏู ููุฌูุฏ ุญุณุงุจ ุจุงูฺฉ ุดูุฏ (ุงฺฏุฑ ฺูู ูุงููู ุชุนุฑู ุดุฏู ุจุงุดุฏ).

### 3. ุฌุฏุงุณุงุฒ (Isolation) ๐๏ธ
ุงู ูฺฺฏ ุจู ุจุญุซ **ููุฒูุงู (Concurrency)** ูุฑุจูุท ูโุดูุฏ. ููุช ฺูุฏู ุชุฑุงฺฉูุด ุจู ุตูุฑุช ููุฒูุงู ุฏุฑ ุญุงู ุงุฌุฑุง ูุณุชูุฏุ `Isolation` ุชุถูู ูโฺฉูุฏ ฺฉู ุขูโูุง ูุฒุงุญู ฺฉุงุฑ ฺฉุฏฺฏุฑ ูุดููุฏ. ูุฑ ุชุฑุงฺฉูุด ุฏุฑ ฺฉ ูุญุท ุงุฒููู ุงุฌุฑุง ูโุดูุฏุ ฺฏู ฺฉู ุชููุง ุชุฑุงฺฉูุด ุฏุฑ ุญุงู ุงุฌุฑุง ุฏุฑ ฺฉู ุณุณุชู ุงุณุช. ุงู ูฺฺฏ ุงุฒ ุจุฑูุฒ ูุดฺฉูุงุช ูุงููุฏ **Dirty Reads** (ุฎูุงูุฏู ุฏุงุฏูโุง ฺฉู ูููุฒ ููุง ูุดุฏู) ุฌููฺฏุฑ ูโฺฉูุฏ. MySQL ุณุทูุญ ูุฎุชูู ุงุฒ ุงุฒูููโุณุงุฒ ุฑุง ุงุฑุงุฆู ูโุฏูุฏ ฺฉู ุฏุฑ ุจุฎุดโูุง ูพุดุฑูุชูโุชุฑ ุจู ุขู ุฎูุงูู ูพุฑุฏุงุฎุช.

### 4. ูพุงุง (Durability) ๐พ
ุงู ูฺฺฏ ุชุถูู ูโฺฉูุฏ ฺฉู ููุช ฺฉ ุชุฑุงฺฉูุด ุจุง ููููุช **Commit** (ููุง) ุดุฏุ ุชุบุฑุงุช ุขู **ุฏุงุฆู** ุฎูุงูุฏ ุจูุฏ ู ุญุช ุฏุฑ ุตูุฑุช ูุทุน ุจุฑู ุง ฺฉุฑุด ฺฉุฑุฏู ุณุฑูุฑุ ุงุฒ ุจู ูุฎูุงูุฏ ุฑูุช. InnoDB ุงู ฺฉุงุฑ ุฑุง ุจุง ููุดุชู ุชุบุฑุงุช ุฏุฑ ูุงฺฏโูุง ูุฎุตูุต (Transaction Logs) ูุจู ุงุฒ ุงุนูุงู ููุง ุขูโูุง ุงูุฌุงู ูโุฏูุฏ.

-----

### ๐ก ูฺฉุชู ูพุดุฑูุชู: ุชุฑุงฺฉูุด ุจุฑุง ุงูุฒุงุด ุณุฑุนุช (Bulk Operations)

ุนูุงูู ุจุฑ **ุงูู**ุ ุชุฑุงฺฉูุดโูุง ฺฉ ูุฒุช **ุณุฑุนุช** ูููโุงูุนุงุฏู ุฏุฑ ุนููุงุชโูุง ุฏุณุชูโุง (Bulk) ุฏุงุฑูุฏ.

* **ุญุงูุช ูพุดโูุฑุถ (Autocommit):** ุจู ุทูุฑ ูพุดโูุฑุถุ MySQL ุฏุฑ ุญุงูุช `autocommit=1` ฺฉุงุฑ ูโฺฉูุฏ. ุงู ุนู **ูุฑ ุฏุณุชูุฑ SQL ุชฺฉุ ฺฉ ุชุฑุงฺฉูุด ฺฉุงูู ูุญุณูุจ ูโุดูุฏ**.
* **ูุดฺฉู ฺฉุฌุงุณุชุ** ููุช ุดูุง ฑฐฐ ุฏุณุชูุฑ `UPDATE` ุฑุง ุฏุฑ ฺฉ ุญููู ุงุฌุฑุง ูโฺฉูุฏุ ุฏุฑ ูุงูุน **ฑฐฐ ุชุฑุงฺฉูุด ุฌุฏุงฺฏุงูู** ุงุฌุฑุง ฺฉุฑุฏูโุงุฏ. ุจุฑุง ุชุถูู ูฺฺฏ ยซูพุงุงยป (Durability)ุ InnoDB *ูุฌุจูุฑ* ุงุณุช ูพุณ ุงุฒ *ูุฑ* ุฏุณุชูุฑุ ุชุบุฑุงุช ุฑุง ุฑู ุฏุณฺฉ ูุฒฺฉ (Log File) ุซุจุช ฺฉูุฏ. ุงู ุนู ฑฐฐ ุนููุงุช I/O ุฏุณฺฉ ูุฌุฒุง ู ุจุณุงุฑ ฺฉูุฏ.
* **ุฑุงูโุญู ุชุฑุงฺฉูุด:** ููุช ุดูุง ุฏุณุชูุฑุงุช ุฑุง ุฏุฑูู ฺฉ ุจูุงฺฉ `START TRANSACTION ... COMMIT` ูุฑุงุฑ ูโุฏูุฏุ ุดูุง ุจู InnoDB ูโฺฏูุฏ ฺฉู ุชูุงู ฑฐฐ ุชุบุฑ ุฑุง ุฏุฑ ุญุงูุธู ุซุจุช ฺฉูุฏ ู ุฏุฑ ูพุงุงูุ **ููุท ฺฉ ุจุงุฑ** ู ุจู ุตูุฑุช ฺฉุฌุงุ ูุชุฌู ููุง ุฑุง ุฑู ุฏุณฺฉ ุซุจุช ฺฉูุฏ.

**ูุชุฌู:** ุดูุง ุจุง ุจุณุชูโุจูุฏ ุนููุงุชโูุง ุฏุณุชูโุง ุฏุฑ ฺฉ ุชุฑุงฺฉูุดุ ูุฒููโ ุนููุงุช ุฑุง ุงุฒ **ฑฐฐ ุจุงุฑ ููุดุชู ุฑู ุฏุณฺฉ** ุจู **ฑ ุจุงุฑ ููุดุชู ุฑู ุฏุณฺฉ** ฺฉุงูุด ูโุฏูุฏ ฺฉู ุจุงุนุซ ุงูุฒุงุด ฺุดูฺฏุฑ ุณุฑุนุช ูโุดูุฏ.

-----

## ฺฉุงุฑ ุจุง ุชุฑุงฺฉูุดโูุง ุฏุฑ SQL

ุณู ุฏุณุชูุฑ ุงุตู ุจุฑุง ูุฏุฑุช ุชุฑุงฺฉูุดโูุง ูุฌูุฏ ุฏุงุฑุฏ:

* **ุข) `START TRANSACTION` (ุง `BEGIN`)**: ุดุฑูุน ฺฉ ุจูุงฺฉ ุชุฑุงฺฉูุด ุฌุฏุฏ.
* **ุจ) `COMMIT`**: ููุง ฺฉุฑุฏู ุชุฑุงฺฉูุด. ุชูุงู ุชุบุฑุงุช ุงูุฌุงู ุดุฏู ุงุฒ ุฒูุงู `START TRANSACTION` ุจู ุตูุฑุช ุฏุงุฆู ุฏุฑ ุฏุชุงุจุณ ุฐุฎุฑู ูโุดููุฏ.
* **ูพ) `ROLLBACK`**: ูุบู ุชุฑุงฺฉูุด. ุชูุงู ุชุบุฑุงุช ุงูุฌุงู ุดุฏู ุงุฒ ุฒูุงู `START TRANSACTION` ูุงุฏุฏู ฺฏุฑูุชู ุดุฏู ู ุฏุชุงุจุณ ุจู ุญุงูุช ูุจู ุงุฒ ุดุฑูุน ุชุฑุงฺฉูุด ุจุงุฒูโฺฏุฑุฏุฏ.

### ุณูุงุฑู ฺฉูุงุณฺฉ: ุงูุชูุงู ูุฌู ุจุงูฺฉ

ุจุงุฏ ุจุจูู ฺฉ ุชุฑุงฺฉูุด ฺฺฏููู ุงุฒ ูุงุฌุนู ุฌููฺฏุฑ ูโฺฉูุฏ.

**ุจุฏูู ุชุฑุงฺฉูุด (ุฑูุด ุฎุทุฑูุงฺฉ):**
<div dir="ltr">

```sql
-- example

-- 1. ฺฉู ฺฉุฑุฏู ุตุฏ ูุงุญุฏ ุงุฒ ุญุณุงุจ ุงูู
UPDATE accounts SET balance = balance - 100 WHERE id = 'A';

-- !!! ุงฺฏุฑ ุณุฑูุฑ ุฏุฑ ุงู ูุญุธู ฺฉุฑุด ฺฉูุฏุ ูพูู ุงุฒ ุญุณุงุจ ุงูู ฺฉู ุดุฏู ุงูุง ูุฑฺฏุฒ ุจู ุญุณุงุจ ุฏูู ุงุถุงูู ููโุดูุฏ!

-- 2. ุงุถุงูู ฺฉุฑุฏู ุตุฏ ูุงุญุฏ ุจู ุญุณุงุจ ุฏูู
UPDATE accounts SET balance = balance + 100 WHERE id = 'B';
```
</div>

**ุจุง ุชุฑุงฺฉูุด (ุฑูุด ุงูู ู ุตุญุญ):**
<div dir="ltr">

```sql
START TRANSACTION;

-- ุชูุงุด ุจุฑุง ุงูุฌุงู ุนููุงุช
UPDATE accounts SET balance = balance - 100 WHERE id = 'A';
UPDATE accounts SET balance = balance + 100 WHERE id = 'B';

-- ุงฺฏุฑ ูุฑ ุฏู ุฏุณุชูุฑ ุจุงูุง ุจุฏูู ุฎุทุง ุงุฌุฑุง ุดููุฏุ ุชุฑุงฺฉูุด ุฑุง ููุง ูโฺฉูู.
COMMIT;

-- ุงฺฏุฑ ุฏุฑ ูุฑ ูุฑุญููโุง ุฎุทุง ุฑุฎ ุฏูุฏ (ูุซูุงู ุจู ุฏูู ููู ุจูุฏู ุฌุฏูู ุง ูุฑ ูุดฺฉู ุฏฺฏุฑ)ุ
-- ูโุชูุงูู (ุง ุณุณุชู ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ) ุชุฑุงฺฉูุด ุฑุง ูุบู ฺฉูู.
-- ROLLBACK;
```
</div>

ุฏุฑ ุงู ุญุงูุชุ ุงฺฏุฑ ุจู ุฏู `UPDATE` ุณุฑูุฑ ุงุฒ ฺฉุงุฑ ุจูุชุฏุ ูพุณ ุงุฒ ุฑุงูโุงูุฏุงุฒ ูุฌุฏุฏุ InnoDB ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุชุฑุงฺฉูุด ูุงูุต ุฑุง `ROLLBACK` ฺฉุฑุฏู ู ุฏุชุงุจุณ ุจู ุญุงูุช ุณุงุฒฺฏุงุฑ ุงููู ุฎูุฏ ุจุงุฒูโฺฏุฑุฏุฏ.

---
[โฉ ุฏุฑุณ ูุจู: ุงูุฏฺฉุณโฺฏุฐุงุฑ ูพุดุฑูุชู](../02-Advanced-Indexing/README.md) | [๐ผ ุจุงุฒฺฏุดุช ุจู ููุฑุณุช ูุตู](../README.md) | [๐ ูุดุงูุฏู ููููู ฺฉุฏ](examples.sql) | [ุฏุฑุณ ุจุนุฏ: View ูุง ู ุฑูุชูโูุง โช](../04-Views-And-Stored-Routines/README.md)

</div>
